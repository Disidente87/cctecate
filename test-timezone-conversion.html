<!DOCTYPE html>
<html>
<head>
    <title>Test Timezone Conversion</title>
</head>
<body>
    <h1>Test Timezone Conversion</h1>
    <div id="results"></div>

    <script>
        function convertLocalToUTC(localTime) {
            if (!localTime) return localTime
            
            // Crear una fecha de hoy con la hora local
            const today = new Date()
            const [hours, minutes] = localTime.split(':')
            const localDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), parseInt(hours), parseInt(minutes))
            
            // Convertir a UTC (RESTAR el offset, no sumar)
            const utcDate = new Date(localDate.getTime() - (localDate.getTimezoneOffset() * 60000))
            
            // Formatear como HH:MM
            const utcHours = String(utcDate.getUTCHours()).padStart(2, '0')
            const utcMinutes = String(utcDate.getUTCMinutes()).padStart(2, '0')
            
            return `${utcHours}:${utcMinutes}`
        }

        function getLocalTimeFromTimestamp(timestamp) {
            if (!timestamp) return ''
            
            const date = new Date(timestamp)
            const localHours = String(date.getHours()).padStart(2, '0')
            const localMinutes = String(date.getMinutes()).padStart(2, '0')
            
            return `${localHours}:${localMinutes}`
        }

        // Test cases
        const testTimes = ['22:33', '21:03', '19:30', '15:45']
        const results = document.getElementById('results')
        
        results.innerHTML = '<h2>Timezone Conversion Test</h2>'
        results.innerHTML += `<p>Your timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}</p>`
        results.innerHTML += `<p>Timezone offset: ${new Date().getTimezoneOffset()} minutes</p><br>`
        
        testTimes.forEach(localTime => {
            const utcTime = convertLocalToUTC(localTime)
            
            // Simular lo que hace la base de datos
            const today = new Date()
            const [year, month, day] = [today.getFullYear(), today.getMonth() + 1, today.getDate()]
            const dbTimestamp = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}T${utcTime}:00Z`
            
            // Convertir de vuelta a local
            const backToLocal = getLocalTimeFromTimestamp(dbTimestamp)
            
            results.innerHTML += `
                <div style="border: 1px solid #ccc; padding: 10px; margin: 5px;">
                    <strong>Local Time:</strong> ${localTime}<br>
                    <strong>UTC Time:</strong> ${utcTime}<br>
                    <strong>DB Timestamp:</strong> ${dbTimestamp}<br>
                    <strong>Back to Local:</strong> ${backToLocal}<br>
                    <strong>Match:</strong> ${localTime === backToLocal ? '✅' : '❌'}
                </div>
            `
        })
    </script>
</body>
</html>
